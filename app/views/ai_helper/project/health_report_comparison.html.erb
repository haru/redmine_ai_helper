<% content_for :header_tags do %>
  <%= javascript_include_tag 'ai_helper_markdown_parser', plugin: 'redmine_ai_helper' %>
  <%= javascript_include_tag 'ai_helper_comparison', plugin: 'redmine_ai_helper' %>
  <%= stylesheet_link_tag 'ai_helper', plugin: 'redmine_ai_helper' %>

  <meta name="i18n-error-message" content="<%= l(:label_ai_helper_error) %>" />
  <meta name="i18n-generating" content="<%= l('ai_helper.project_health.generating') %>" />
<% end %>

<h2><%= l('ai_helper.health_report_comparison.page_title') %></h2>

<div class="ai-helper-comparison-container box">
  <!-- Comparison header: Two report information -->
  <div class="ai-helper-comparison-header">
    <div class="ai-helper-comparison-report-info">
      <div class="old-report-info">
        <h3><%= l('ai_helper.health_report_comparison.old_report') %></h3>
        <p>
          <strong><%= l(:field_created_on) %>:</strong> <%= format_time(@old_report.created_at) %><br/>
          <strong><%= l(:field_author) %>:</strong> <%= link_to_user @old_report.user %><br/>
          <strong><%= l(:field_id) %>:</strong> #<%= @old_report.id %>
        </p>
      </div>

      <div class="comparison-arrow">
        <span class="icon icon-move"></span>
      </div>

      <div class="new-report-info">
        <h3><%= l('ai_helper.health_report_comparison.new_report') %></h3>
        <p>
          <strong><%= l(:field_created_on) %>:</strong> <%= format_time(@new_report.created_at) %><br/>
          <strong><%= l(:field_author) %>:</strong> <%= link_to_user @new_report.user %><br/>
          <strong><%= l(:field_id) %>:</strong> #<%= @new_report.id %>
        </p>
      </div>
    </div>

    <div class="ai-helper-comparison-actions">
      <%= link_to l(:button_back),
                  ai_helper_dashboard_path(@project, tab: 'health_report'),
                  class: 'icon icon-cancel' %>

      <%= link_to l('ai_helper.health_report_comparison.analyze_button'),
                  ai_helper_health_report_compare_analyze_path(@project,
                    old_report_id: @old_report.id,
                    new_report_id: @new_report.id),
                  id: 'analyze-changes-button',
                  class: 'icon icon-checked',
                  data: {
                    old_report_id: @old_report.id,
                    new_report_id: @new_report.id
                  } %>
    </div>
  </div>

  <!-- Analysis result display area -->
  <div class="ai-helper-comparison-result">
    <div id="ai-helper-comparison-analysis" class="ai-helper-comparison-content">
      <div class="ai-helper-comparison-placeholder">
        <p><%= l('ai_helper.health_report_comparison.placeholder') %></p>
      </div>
    </div>
  </div>
</div>
